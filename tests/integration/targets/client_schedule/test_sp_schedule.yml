---
- name: "Test IBM Storage Protect Schedule Role"
  hosts: localhost
  gather_facts: false
  become: false

  roles:
    - ibm.storage_protect.schedule
    
- name: Test schedule definition in IBM Storage Protect
  hosts: storage_protect_server
  vars:
    storage_protect_server_name: IBMSPSVR01
    storage_protect_username: adminuser
    storage_protect_password: adminPassword12345678
    storage_protect_schedules:
      - name: "DailyTestBackup"
        domain_name: "TestDomain"
        description: "Test schedule for daily backups"
        action: "Incremental"
        subaction: ""
        options: "-subdir=yes"
        objects: "/data"
        priority: 3
        start_date: "{{ ansible_date_time.date }}"
        start_time: "04:00"
        duration: 2
        dur_units: "Hours"
        max_runtime: 0
        sched_style: "Enhanced"
        month: "ANY"
        day_of_month: "ANY"
        week_of_month: "ANY"
        day_of_week: "WEEKDay"
        expiration: "Never"

  tasks:
    - name: "Verify the Result of the Schedule Creation"
      debug:
        msg: "Schedule creation test completed successfully."
